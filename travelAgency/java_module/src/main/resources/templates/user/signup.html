<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/layout/head :: headFragment}"></th:block>
<body>
<header th:replace="~{layout/header :: headerFragment}"></header>
<nav th:replace="~{layout/nav :: navFragment}"></nav>
<main class="main-content">

    <!-- ✨ Progress UI: step-ui-container 로 분리 -->
    <section class="step-ui-container">
        <h2>회원가입</h2>
        <div class="step-ui">
            <div class="step step1 active"><span>1. 약관동의</span></div>
            <div class="step step2"><span>2. 정보입력</span></div>
            <div class="step step3"><span>3. 입력확인</span></div>
            <div class="step step4"><span>4. 가입완료</span></div>
        </div>
    </section>

    <!-- 1. 약관동의 -->
    <section class="contact step1">
        <!-- ... 약관 리스트 ... -->
        <div class="terms-list">
            <div class="term-item">
                <label>
                    <input type="checkbox" name="agree_terms_service" id="agree_terms_service" required>
                    <a href="/pdf/terms_service.pdf" class="view-pdf" data-pdf-url="/pdf/terms_service.pdf" target="_blank">서비스 이용약관 (필수)</a>
                </label>
            </div>
            <div class="term-item">
                <label>
                    <input type="checkbox" name="agree_terms_privacy" id="agree_terms_privacy" required>
                    <a href="/pdf/terms_privacy.pdf" class="view-pdf" data-pdf-url="/pdf/terms_privacy.pdf" target="_blank">개인정보 수집 및 이용 동의 (필수)</a>
                </label>
            </div>
            <div class="term-item">
                <label>
                    <input type="checkbox" name="agree_terms_marketing" id="agree_terms_marketing">
                    <a href="/pdf/terms_marketing.pdf" class="view-pdf" data-pdf-url="/pdf/terms_marketing.pdf" target="_blank">(선택) 마케팅 정보 수신 동의</a>
                </label>
            </div>
        </div>
        <div class="button-group">
            <button type="button"
                    class="next-step pretty-button"
                    data-next="step2"
                    disabled
                    id="next-step-terms">다음 단계</button>
        </div>
    </section>

    <!-- 2. 정보입력 -->
    <section class="contact step2">
        <!-- ... 폼 ... -->
        <form method="post" th:action="@{/inquiry}" id="inquiry" class="terms-list">
            <table class="form-table">
                <tr>
                    <td class="col1"> 성명 <span class="warn">*</span></td>
                    <td class="col2"><input type="text" name="username" id="username" placeholder="홍길동" required></td>
                </tr>
                <tr>
                    <td class="col1"> 휴대폰번호 <span class="warn">*</span></td>
                    <td class="col2"><input type="tel" name="tel" id="tel" placeholder="010-0000-0000" required></td>
                </tr>
                <tr>
                    <td class="col1"> 이메일 <span class="warn">*</span></td>
                    <td class="col2"><input type="email" name="email" id="email" placeholder="example@google.com" required></td>
                </tr>
                <tr>
                    <td class="col1"> 유형 <span class="warn">*</span></td>
                    <td class="col2">
                        <input type="radio" name="userType" id="personal" value="personal" checked>
                        <label for="personal">개인</label>
                        <input type="radio" name="userType" id="corporate" value="corporate">
                        <label for="corporate">기업</label>
                        <input type="radio" name="userType" id="group" value="group">
                        <label for="group">단체</label>
                    </td>
                </tr>
                <tr>
                    <td class="col1"> 문의구분 <span class="warn">*</span></td>
                    <td class="col2">
                        <input type="checkbox" name="businesstrip" id="businesstrip" checked>
                        <label for="businesstrip">출장</label>
                        <input type="checkbox" name="edu" id="edu">
                        <label for="edu">연수/교육</label>
                        <input type="checkbox" name="conference" id="conference">
                        <label for="conference">학회/협회</label>
                        <input type="checkbox" name="etc" id="etc">
                        <label for="etc">기타</label>
                    </td>
                </tr>
            </table>
        </form>
        <div class="button-group">
            <button type="button"
                    class="next-step pretty-button"
                    data-next="step3"
                    id="next-step-info">다음 단계</button>
        </div>
    </section>

    <!-- 3. 입력확인 -->
    <section class="contact step3">
        <!-- ... 확인 테이블 ... -->
        <table class="form-table terms-list">
            <tr>
                <td class="col1"> 성명</td>
                <td class="col2" id="confirm-username"></td>
            </tr>
            <tr>
                <td class="col1"> 휴대폰번호</td>
                <td class="col2" id="confirm-tel"></td>
            </tr>
            <tr>
                <td class="col1"> 이메일</td>
                <td class="col2" id="confirm-email"></td>
            </tr>
            <tr>
                <td class="col1"> 유형</td>
                <td class="col2" id="confirm-type"></td>
            </tr>
            <tr>
                <td class="col1"> 문의구분</td>
                <td class="col2" id="confirm-category"></td>
            </tr>
        </table>
        <div class="button-group">
            <button type="button"
                    class="next-step pretty-button"
                    data-next="step4"
                    id="next-step-confirm">확인 및 가입</button>
        </div>
    </section>

    <!-- 4. 회원가입 완료 -->
    <section class="contact step4">
        <h2>회원가입이 완료되었습니다!</h2>
        <p><a th:href="@{/}">로그인하고 서비스 보러가기</a></p>
    </section>

</main>
<footer th:replace="~{layout/footer :: footerFragment}"></footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function() {
        // 1) 초기 세팅: 모든 .contact 숨기고 step1만 보이게
        $('.contact').hide();
        $('.contact.step1').show();

        // 2) 약관 동의 체크박스
        $('#agree_terms_service, #agree_terms_privacy').on('change', function() {
            const ready = $('#agree_terms_service').is(':checked')
                && $('#agree_terms_privacy').is(':checked');
            $('#next-step-terms').prop('disabled', !ready);
        });

        // 3) 스텝 이동 공통 처리
        $('.next-step').on('click', function() {
            const next = $(this).data('next');             // "step2", "step3", "step4"

            // 3단계 확인 화면일 경우, 입력값 복사
            if ( next === 'step3' ) {
                $('#confirm-username').text($('#username').val());
                $('#confirm-tel').text($('#tel').val());
                $('#confirm-email').text($('#email').val());
                $('#confirm-type').text($('input[name="userType"]:checked').next('label').text());
                const cats = [];
                $('input[type="checkbox"]:checked').each(function(){
                    cats.push($(this).next('label').text());
                });
                $('#confirm-category').text(cats.join(', '));
            }

            // 실제 섹션 토글
            $('.contact').hide();
            $(`.contact.${next}`).show();

            // progress UI 업데이트
            $('.step-ui .step').removeClass('active');
            $(`.step-ui .step.${next}`).addClass('active');
        });
    });
</script>
</body>
</html>
