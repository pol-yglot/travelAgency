<!DOCTYPE html>
<html lang="ko">
<th:block th:replace="/layout/head :: headFragment"></th:block>
<body>
<header th:replace="~{layout/header :: headerFragment}"></header>
<nav th:replace="~{layout/nav :: navFragment}"></nav>
<main class="main-content">
    <link href="/css/profile.css" rel="stylesheet">
    <section class="profile">
        <div class="profile-header">
            <div class="profile-background"></div>
            <div class="profile-avatar">
                <div class="profile-info">
                    <h2 th:text="${user.USER_NAME} + '님, 안녕하세요! :)'"></h2>
                    <p th:text="${user.USER_EMAIL}"></p>
                </div>
                <img th:src="${userDetail.USER_PROFILE_IMAGE_URL}" alt="프로필 사진">
            </div>
        </div>

        <div class="profile-content">
            <div class="profile-section">
                <h3>활동 기록</h3>
                <ul class="activity-list">
                    <li>게시글 1: 2024-01-01</li>
                    <li>댓글 2: 2024-01-02</li>
                    <li>좋아요 3: 2024-01-03</li>
                </ul>
            </div>

            <div class="profile-section">
                <h3>관심분야</h3>
                <input type="hidden" id="displayArea" th:value="${userDetail.USER_PREFERENCE}" >
                <p class="preference" id="preference"></p>
                <!--<tr>
                    <td class="col1"> 관심분야</td>
                    <label class="label-form" for="preference"></label>
                    <input type="hidden" id="displayArea" th:value="${userDetail.USER_PREFERENCE}" >
                    <td class="col2"><input type="text" name="preference" id="preference"></td>
                </tr>-->
            </div>

            <div class="profile-section">
                <h3>프로필 수정</h3>
                <button class="edit-profile-button" id="edit-profile-button">프로필 수정</button>
            </div>
        </div>

        <div class="profile-content">
            <div class="profile-section">
                <h3>찜 목록</h3>
                <ul class="wish-list">
                    <li>상품 1</li>
                    <li>상품 2</li>
                    <li>상품 3</li>
                </ul>
            </div>

            <div class="profile-section">
                <h3>문의 내역</h3>
                <ul class="recommend-list">
                    <li>추천 상품 1</li>
                    <li>추천 상품 2</li>
                    <li>추천 상품 3</li>
                </ul>
            </div>

            <div class="profile-section">
                <h3>출장 리포트</h3>
                <ul class="recommend-list">
                    <li>추천 상품 1</li>
                    <li>추천 상품 2</li>
                    <li>추천 상품 3</li>
                </ul>
            </div>
        </div>

    </section>
</main>
<footer th:replace="~{layout/footer :: footerFragment}"></footer>
<script>
    $(document).ready(function () {

        $('#edit-profile-button').click(function () {
            location.replace("/user/updateProfile");
        });

        const userPreferenceJson = $("#displayArea").val();

        if (userPreferenceJson) {
            try {
                const userPreference = JSON.parse(userPreferenceJson);
                const displayValues = [
                    userPreference.travelStyle,
                    userPreference.accommodationType,
                    userPreference.interestedRegions ? userPreference.interestedRegions.join(", ") : "",
                    userPreference.hotelAmenities ? userPreference.hotelAmenities.join(", ") : "",
                    userPreference.foodType ? userPreference.foodType.join(", ") : "",
                    userPreference.spicyFoodPreference,
                    userPreference.preferredPriceRangeAccommodation,
                    userPreference.activityPreference ? Object.values(userPreference.activityPreference).join(", ") : ""
                ].filter(Boolean);

                $("#preference").text(displayValues.join(", "));

            } catch (error) {
                console.error("JSON 파싱 오류:", error);
                $("#preference").text("데이터 오류");
            }
        }
    });
</script>
</body>
</html>